<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Control de Video en Página Padre (Corregido)</title>
    <style>
        body { font-family: sans-serif; margin: 20px; background-color: #f4f4f4; text-align: center; }
        h1 { color: #333; }
        
        #contentContainer {
            border: 3px solid #007bff; width: 800px; height: 450px;
            margin: 20px auto; background-color: #000;
        }

        #contentFrame {
            display: none; width: 100%; height: 100%; border: none;
        }

        /* --- Estilos para el Modal --- */
        .modal {
            display: none; position: fixed; z-index: 1; left: 0; top: 0;
            width: 100%; height: 100%; overflow: auto; 
            background-color: rgba(0,0,0,0.6);
            justify-content: center; align-items: center;
        }
        .modal-content {
            background-color: #fefefe; margin: auto; padding: 30px;
            border: 1px solid #888; width: 80%; max-width: 500px;
            text-align: center; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .modal-content h2 { color: #d9534f; margin-bottom: 20px; }
        .modal-content.success h2 { color: #5cb85c; }
        
        .modal-content button {
            background-color: #007bff; color: white; padding: 10px 20px;
            border: none; border-radius: 5px; cursor: pointer; font-size: 16px; margin-top: 15px;
        }
        /* (NUEVO) Estilo para el botón de cerrar pausa */
        .modal-content button.btn-close {
            background-color: #f0ad4e;
            margin-left: 10px;
        }

        #contentFrame {
    display: none; 
    width: 800px; 
    height: 450px; 
    border: 3px solid #5cb85c;
    margin: 20px auto;
}
    </style>
</head>
<body>

    <h1>Control de Video en el Padre</h1>
    <p>Mira el video para poder avanzar al siguiente contenido.</p>

    <div id="contentContainer">
        <div id="player"></div>
    </div>

      <iframe id="contentFrame" src="about:blank"></iframe>

    <div id="pauseModal" class="modal">
        <div class="modal-content">
            <h2>¡Atención!</h2>
            <p>Debes terminar de ver el video para poder avanzar. Por favor, reanuda el video.</p>
            <button id="closePauseButton" class="btn-close">Cerrar y Reanudar</button>
        </div>
    </div>
    
    <div id="finishedModal" class="modal">
        <div class="modal-content success">
            <h2>¡Video Terminado!</h2>
            <p>Has completado el video. ¡Ahora puedes continuar!</p>
            <button id="continueButton">Continuar</button>
        </div>
    </div>

    <script src="https://www.youtube.com/iframe_api"></script>

    <script>
        // Referencias a elementos del DOM
        const pauseModal = document.getElementById('pauseModal');
        const finishedModal = document.getElementById('finishedModal');
        const continueButton = document.getElementById('continueButton');
        const playerDiv = document.getElementById('player');
        const contentFrame = document.getElementById('contentFrame');
        
        // (NUEVO) Botón de cerrar modal de pausa
        const closePauseButton = document.getElementById('closePauseButton');

        var player;
        var videoHasEnded = false; // Bandera para saber si el video ya terminó
        
        // (NUEVO) Temporizador para evitar el falso positivo de pausa
        var pauseTimer = null;

        // 1. La API llama a esta función cuando está lista
        function onYouTubeIframeAPIReady() {
            console.log('API de YouTube lista.');
            player = new YT.Player('player', {
                height: '450',
                width: '800',
                videoId: '5M9AkkFlroI', // Video de ejemplo (corto)
                playerVars: {
                    'playsinline': 1,
                },
                events: {
                    'onStateChange': onPlayerStateChange
                }
            });
        }

        // 2. Esta función se llama cada vez que el estado del video cambia
        function onPlayerStateChange(event) {
            console.log('Nuevo estado:', event.data);

            // Limpiamos el temporizador de pausa cada vez que hay un cambio
            clearTimeout(pauseTimer);

            switch (event.data) {
                case YT.PlayerState.PLAYING:
                    pauseModal.style.display = 'none'; // Ocultar modal de pausa
                    break;
                
                case YT.PlayerState.PAUSED:
                    // (ARREGLO 2) Si se pausa Y AÚN NO HA TERMINADO...
                    if (!videoHasEnded) {
                        // ...iniciamos un temporizador.
                        pauseTimer = setTimeout(() => {
                            // Si después de 250ms sigue pausado, MOSTRAMOS el modal.
                            // Esto evita que el "scrubbing" (mover la barra) lo active.
                            if (player.getPlayerState() === YT.PlayerState.PAUSED) {
                                pauseModal.style.display = 'flex';
                            }
                        }, 250); // 250 milisegundos de espera
                    }
                    break;
                
                case YT.PlayerState.ENDED:
                    videoHasEnded = true;
                    pauseModal.style.display = 'none'; 
                    finishedModal.style.display = 'flex';
                    break;

                case YT.PlayerState.BUFFERING:
                    // Si está cargando (buffer), nos aseguramos de que el timer se cancele
                    // y el modal no se muestre.
                    clearTimeout(pauseTimer);
                    break;
            }
        }

        // 3. (ARREGLO 1) Evento del nuevo botón "Cerrar y Reanudar"
        closePauseButton.addEventListener('click', () => {
            console.log('Botón "Cerrar y Reanudar" presionado.');
            pauseModal.style.display = 'none'; // Ocultar modal
            player.playVideo(); // Reanudar el video
        });

        // 4. (ARREGLO 3) Evento del botón "Continuar" (con depuración)
 continueButton.addEventListener('click', () => {
    finishedModal.style.display = 'none';
    
    // Ocultar el contenedor del video
    document.getElementById('contentContainer').style.display = 'none';
    
    // Mostrar el iframe
    contentFrame.src = 'slave2.html';
    contentFrame.style.display = 'block';
});
    </script>

</body>
</html>
